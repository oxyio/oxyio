(function(){"use strict";window.addEventListener("load",function(){var textWidthTester=document.createElement("div");textWidthTester.style.visibility="hidden";textWidthTester.style.float="left";textWidthTester.textContent="a";document.body.appendChild(textWidthTester);var textWidth=textWidthTester.offsetWidth;document.body.removeChild(textWidthTester);var multiSelects=document.querySelectorAll("select[multiple]"),i;for(i=0;i<multiSelects.length;i++){var multiSelect=multiSelects[i],container=document.createElement("div"),searchBox=document.createElement("input"),activeList=document.createElement("ul"),optionsList=document.createElement("ul"),options=multiSelect.querySelectorAll("option"),justClicked=false;container.className="multiselect";activeList.className="multiselect-active";optionsList.className="multiselect-options";multiSelect.style.display="none";optionsList.style.display="none";container.addEventListener("click",function(){justClicked=true;setTimeout(function(){justClicked=false},150);searchBox.focus()});searchBox.addEventListener("focus",function(){optionsList.style.display="block"});optionsList.addEventListener("click",function(){justClicked=true;setTimeout(function(){justClicked=false},150)});searchBox.addEventListener("blur",function(){setTimeout(function(){if(!justClicked)optionsList.style.display="none"},100)});var moveOptionList=function(){optionsList.style.marginTop=activeList.offsetHeight+1+"px"};var filterSearch=function(ev){var regex=new RegExp(searchBox.value,"i"),targets=optionsList.querySelectorAll("li"),i;for(i=0;i<targets.length;i++){var target=targets[i];if(target.classList.contains("selected"))continue;if(!target.textContent.match(regex)){target.style.display="none"}else{target.style.display="block"}}searchBox.style.width=searchBox.value.length*textWidth+25+"px";moveOptionList()};searchBox.addEventListener("keyup",filterSearch);var createDeselected=function(option,selected){var item=document.createElement("li");item.textContent=option.textContent;item.addEventListener("click",function(ev){item.style.display="none";item.classList.add("selected");selectOption(option)});if(selected){item.style.display="none";item.classList.add("selected")}optionsList.appendChild(item);option._deselected=item};var selectOption=function(option){option.selected=true;searchBox.value="";filterSearch();var item=document.createElement("li");item.textContent=option.textContent;item.addEventListener("click",function(ev){ev.stopPropagation();activeList.removeChild(item);deselectOption(option)});activeList.insertBefore(item,searchBox);if(!option._deselected){createDeselected(option,true)}moveOptionList()};var deselectOption=function(option){option.selected=false;if(option._deselected){option._deselected.style.display="block";option._deselected.classList.remove("selected")}else{createDeselected(option)}moveOptionList()};activeList.appendChild(searchBox);container.appendChild(optionsList);container.appendChild(activeList);multiSelect.parentNode.insertBefore(container,multiSelect);for(i=0;i<options.length;i++){var option=options[i];option.selected?selectOption(option):deselectOption(option)}}})})();